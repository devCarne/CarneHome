<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="stu.kms.carnehome.mapper.PostMapper">

    <sql id="searchTypeSql">
        <choose>
            <when test="searchType == 'T'.toString()">
                TITLE like '%'||#{keyword}||'%' AND
            </when>
            <when test="searchType == 'C'.toString()">
                CONTENT like '%'||#{keyword}||'%' AND
            </when>
            <when test="searchType == 'U'.toString()">
                USERNAME like '%'||#{keyword}||'%' AND
            </when>
            <when test="searchType == 'TC'.toString()">
                (TITLE like '%'||#{keyword}||'%' OR CONTENT like '%'||#{keyword}||'%') AND
            </when>
        </choose>
    </sql>

    <select id="getList" resultType="stu.kms.carnehome.domain.PostVO">
        select postNo, title, content, username, postDate, updateDate, replyCount
        from (
            select /*+INDEX_DESC(CARNEHOME_POST PK_POST)*/ ROWNUM RN, postno, title, content, username, postdate, updatedate, replycount
            from CARNEHOME_POST
            where <include refid="searchTypeSql"/> rownum &lt;= #{pageNum} * #{amountPerPage}
            )
        where RN > (#{pageNum} -1) * #{amountPerPage}
    </select>

    <select id="getPostCount" resultType="Long">
        select count(*) from CARNEHOME_POST where POSTNO > 0
    </select>

    <select id="getPost" resultType="stu.kms.carnehome.domain.PostVO">
        select * from CARNEHOME_POST where POSTNO = #{postNo}
    </select>

    <update id="modify">
        update CARNEHOME_POST
        set TITLE = #{title}, CONTENT = #{content}, USERNAME = #{userName}, UPDATEDATE = sysdate
        where POSTNO = #{postNo}
    </update>

    <insert id="write">
        <selectKey keyProperty="postNo" order="BEFORE" resultType="long">
            select SEQ_POST.nextval from dual
        </selectKey>
        INSERT into CARNEHOME_POST (POSTNO, TITLE, CONTENT, USERNAME)
        values (#{postNo}, #{title}, #{content}, #{userName})
    </insert>
</mapper>